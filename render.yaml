services:
  - type: redis
    name: travelland-redis
    plan: free
    ipAllowList: []  # Only accessible from other Render services
    maxmemoryPolicy: allkeys-lru  # Evict least recently used keys when memory is full

  - type: web
    name: TravelLand (single-service)
    env: python
    region: oregon
    plan: free
    buildCommand: |
      echo "Starting build..."
      pip install --no-cache-dir -r requirements.txt && \
      echo "Python dependencies installed" && \
      cd frontend && \
      echo "In frontend directory" && \
      npm ci && \
      echo "npm ci completed" && \
      npm run build && \
      echo "Frontend build completed" && \
      mkdir -p ../city_guides/static && \
      echo "Static directory created" && \
      cp -R dist/. ../city_guides/static/ && \
      cp public/marcos.png ../city_guides/static/ || true && \
      echo "Files copied to static" && \
      ls -la ../city_guides/static/
    envVars:
      - key: NODE_VERSION
        value: "22"
      - key: REDIS_URL
        fromService:
          name: travelland-redis
          type: redis
          property: connectionString
    startCommand: |
      bash start_server.sh
    healthCheckPath: /healthz
    services:
      - name: web
        protocol: http
