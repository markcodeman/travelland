services:
  - type: web
    name: TravelLand (single-service)
    env: python
    region: oregon
    plan: free
    buildCommand: |
      pip install -r city_guides/requirements.txt && \
      mkdir -p city_guides/static && \
      mkdir -p ../city_guides/static && \
      cd frontend && \
      npm ci && \
      npm run build && \
      cp -R dist/. ../city_guides/static/ && \
      cp public/marcos.png ../city_guides/static/ || true
    envVars:
      - key: NODE_VERSION
        value: "18"
    startCommand: |
      # run Hypercorn with python and bind to the PORT Render provides
      bash -lc "cd /opt/render/project/src && export PYTHONPATH=/opt/render/project/src:$PYTHONPATH && python -m hypercorn city_guides.src.app:app --bind 0.0.0.0:$PORT"
    # Environment variables are configured in the Render dashboard; keep secrets out of the manifest
    healthCheckPath: /health
    services:
      - name: web
        protocol: http