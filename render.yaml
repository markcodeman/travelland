services:
  - type: redis
    name: travelland-redis
    plan: free
    ipAllowList: []  # Only accessible from other Render services
    maxmemoryPolicy: allkeys-lru  # Evict least recently used keys when memory is full

  - type: web
    name: TravelLand (single-service)
    env: python
    region: oregon
    plan: free
    buildCommand: |
      pip install --no-cache-dir -r requirements.txt && \
      cd frontend && \
      npm ci && \
      npm run build && \
      cp -R dist/. ../city_guides/static/ && \
      cp public/marcos.png ../city_guides/static/ || true
    envVars:
      - key: NODE_VERSION
        value: "22"
      - key: REDIS_URL
        fromService:
          name: travelland-redis
          type: redis
          property: connectionString
    startCommand: |
      bash start_server.sh
    healthCheckPath: /health
    services:
      - name: web
        protocol: http
